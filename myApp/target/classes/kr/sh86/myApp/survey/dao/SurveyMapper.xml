<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SurveyDao">

<!-- 신보 - 회원번호 검색 -->
<select id="selectSbNum" parameterType="String" resultType="int">
	SELECT SB_NUM
	FROM ADMIN.SINBO
	WHERE SB_HP = #{sbHp}
</select>

<!-- 입력 -->
<insert id="insertRes" parameterType="kr.sh86.myApp.survey.domain.Response">
	<selectKey keyProperty="resNo" resultType="int" order="BEFORE">
		select glocal_res_seq.nextval FROM DUAL
	</selectKey>
	INSERT INTO GLOCAL.RESPONSE(
		RES_NO,
		REGDATE,
		USER_NO,
		SEX,
		GRADE)
	VALUES(
		#{resNo},
		to_char(sysdate,'yyyy-mm-dd'),
		#{userNo},
		#{sex},
		#{grade})
</insert>

<!-- 응답자 조회 -->
<select id="selectUser" parameterType="int" resultType="kr.sh86.myApp.survey.domain.Users">
	SELECT
		*
	FROM
		GLOCAL.USERS
	WHERE
		USER_NO = #{userNo}
</select>

<!-- 응답여부 확인 -->
<select id="selectCountRes" parameterType="int" resultType="int">
	SELECT
		COUNT(*)
	FROM
		GLOCAL.RESPONSE
	WHERE
		USER_NO = #{userNo}
</select>

<!-- 응답내용 조회 -->
<select id="selectResNo" parameterType="int" resultType="int">
	SELECT
		RES_NO
	FROM
		GLOCAL.RESPONSE
	WHERE
		USER_NO = #{userNo}
</select>

<!-- 응답내용 수정 -->
<update id="updateRes" parameterType="kr.sh86.myApp.survey.domain.Response">
	UPDATE GLOCAL.RESPONSE
	SET
		UPDATE_DATE = to_char(sysdate,'yyyy-mm-dd')
		<if test="q1c != null and q1c !=''">,Q1C=#{q1c}</if>
		<if test="q1k != null and q1k !=''">,Q1K=#{q1k}</if>
		<if test="q1m != null and q1m !=''">,Q1M=#{q1m}</if>
		<if test="q1Etc != null and q1Etc !=''">,Q1ETC=#{q1Etc}</if>
		<if test="q2c != null and q2c !=''">,Q2C=#{q2c}</if>
		<if test="q2k != null and q2k !=''">,Q2K=#{q2k}</if>
		<if test="q2m != null and q2m !=''">,Q2M=#{q2m}</if>
		<if test="q3c != null and q3c !=''">,Q3C=#{q3c}</if>
		<if test="q3k != null and q3k !=''">,Q3K=#{q3k}</if>
		<if test="q3m != null and q3m !=''">,Q3M=#{q3m}</if>
		<if test="q4c != null and q4c !=''">,Q4C=#{q4c}</if>
		<if test="q4k != null and q4k !=''">,Q4K=#{q4k}</if>
		<if test="q4m != null and q4m !=''">,Q4M=#{q4m}</if>
		<if test="q5c != null and q5c !=''">,Q5C=#{q5c}</if>
		<if test="q5k != null and q5k !=''">,Q5K=#{q5k}</if>
		<if test="q5m != null and q5m !=''">,Q5M=#{q5m}</if>
		<if test="q6c != null and q6c !=''">,Q6C=#{q6c}</if>
		<if test="q6k != null and q6k !=''">,Q6K=#{q6k}</if>
		<if test="q6m != null and q6m !=''">,Q6M=#{q6m}</if>
		<if test="q6Etc != null and q6Etc !=''">,Q6ETC=#{q6Etc}</if>
		<if test="q7c != null and q7c !=''">,Q7C=#{q7c}</if>
		<if test="q7k != null and q7k !=''">,Q7K=#{q7k}</if>
		<if test="q7m != null and q7m !=''">,Q7M=#{q7m}</if>
		<if test="q8c != null and q8c !=''">,Q8C=#{q8c}</if>
		<if test="q8k != null and q8k !=''">,Q8K=#{q8k}</if>
		<if test="q8m != null and q8m !=''">,Q8M=#{q8m}</if>
		<if test="q9c != null and q9c !=''">,Q9C=#{q9c}</if>
		<if test="q9k != null and q9k !=''">,Q9K=#{q9k}</if>
		<if test="q9m != null and q9m !=''">,Q9M=#{q9m}</if>
		<if test="q10c != null and q10c !=''">,Q10C=#{q10c}</if>
		<if test="q10k != null and q10k !=''">,Q10K=#{q10k}</if>
		<if test="q10m != null and q10m !=''">,Q10M=#{q10m}</if>
		<if test="q11c != null and q11c !=''">,Q11C=#{q11c}</if>
		<if test="q11k != null and q11k !=''">,Q11K=#{q11k}</if>
		<if test="q11m != null and q11m !=''">,Q11M=#{q11m}</if>
		<if test="q11Etc != null and q11Etc !=''">,Q11ETC=#{q11Etc}</if>
		<if test="q12c != null and q12c !=''">,Q12C=#{q12c}</if>
		<if test="q12k != null and q12k !=''">,Q12K=#{q12k}</if>
		<if test="q12m != null and q12m !=''">,Q12M=#{q12m}</if>
		<if test="q13c != null and q13c !=''">,Q13C=#{q13c}</if>
		<if test="q13k != null and q13k !=''">,Q13K=#{q13k}</if>
		<if test="q13m != null and q13m !=''">,Q13M=#{q13m}</if>
		<if test="q14c != null and q14c !=''">,Q14C=#{q14c}</if>
		<if test="q14k != null and q14k !=''">,Q14K=#{q14k}</if>
		<if test="q14m != null and q14m !=''">,Q14M=#{q14m}</if>
		<if test="q14Etc != null and q14Etc !=''">,Q14ETC=#{q14Etc}</if>
		<if test="q15k != null and q15k !=''">,Q15K=#{q15k}</if>
		<if test="q15m != null and q15m !=''">,Q15M=#{q15m}</if>
		<if test="q16k != null and q16k !=''">,Q16K=#{q16k}</if>
		<if test="q16m != null and q16m !=''">,Q16M=#{q16m}</if>
		<if test="q16Etc != null and q16Etc !=''">,Q16ETC=#{q16Etc}</if>
		<if test="q17k != null and q17k !=''">,Q17K=#{q17k}</if>
		<if test="q17m != null and q17m !=''">,Q17M=#{q17m}</if>
		<if test="q18k != null and q18k !=''">,Q18K=#{q18k}</if>
		<if test="q18m != null and q18m !=''">,Q18M=#{q18m}</if>
		<if test="q18Etc != null and q18Etc !=''">,Q18ETC=#{q18Etc}</if>
		<if test="q19k != null and q19k !=''">,Q19K=#{q19k}</if>
		<if test="q19m != null and q19m !=''">,Q19M=#{q19m}</if>
		<if test="q20k != null and q20k !=''">,Q20K=#{q20k}</if>
		<if test="q20m != null and q20m !=''">,Q20M=#{q20m}</if>
		<if test="q20Etc != null and q20Etc !=''">,Q20ETC=#{q20Etc}</if>
		<if test="q21k != null and q21k !=''">,Q21K=#{q21k}</if>
		<if test="q21m != null and q21m !=''">,Q21M=#{q21m}</if>
		<if test="q21Etc != null and q21Etc !=''">,Q21ETC=#{q21Etc}</if>
		<if test="q22k != null and q22k !=''">,Q22K=#{q22k}</if>
		<if test="q22m != null and q22m !=''">,Q22M=#{q22m}</if>
		<if test="q23k != null and q23k !=''">,Q23K=#{q23k}</if>
		<if test="q23m != null and q23m !=''">,Q23M=#{q23m}</if>
		<if test="q23Etc != null and q23Etc !=''">,Q23ETC=#{q23Etc}</if>
		<if test="q24k != null and q24k !=''">,Q24K=#{q24k}</if>
		<if test="q24m != null and q24m !=''">,Q24M=#{q24m}</if>
		<if test="q25k != null and q25k !=''">,Q25K=#{q25k}</if>
		<if test="q25m != null and q25m !=''">,Q25M=#{q25m}</if>
		<if test="q26k != null and q26k !=''">,Q26K=#{q26k}</if>
		<if test="q26m != null and q26m !=''">,Q26M=#{q26m}</if>
		<if test="q26Etc != null and q26Etc !=''">,Q26ETC=#{q26Etc}</if>
		<if test="q27k != null and q27k !=''">,Q27K=#{q27k}</if>
		<if test="q27m != null and q27m !=''">,Q27M=#{q27m}</if>
		<if test="q28k != null and q28k !=''">,Q28K=#{q28k}</if>
		<if test="q28m != null and q28m !=''">,Q28M=#{q28m}</if>
		<if test="q29k != null and q29k !=''">,Q29K=#{q29k}</if>
		<if test="q29m != null and q29m !=''">,Q29M=#{q29m}</if>
		<if test="q30k != null and q30k !=''">,Q30K=#{q30k}</if>
		<if test="q30m != null and q30m !=''">,Q30M=#{q30m}</if>
		<if test="q30Etc != null and q30Etc !=''">,Q30ETC=#{q30Etc}</if>
		<if test="q31Etc != null and q31Etc !=''">,Q31ETC=#{q31Etc}</if>
	WHERE
		RES_NO = #{resNo}
</update>

<!--응답자 마지막 응답번호 수정  -->
<update id="updateUserLastComplete" parameterType="kr.sh86.myApp.survey.domain.Users">
	UPDATE GLOCAL.USERS
	SET
		RES_COMPLETE = #{resComplete}
	WHERE
		USER_NO= #{userNo}
</update>

<!-- 문자> 전체 응답자 조회 -->
<select id="selectUserAll" resultType="kr.sh86.myApp.survey.domain.Users">
	SELECT
		*
	FROM
		GLOCAL.USERS
</select>

<!-- 문자발송 -->
<insert id="sendMmsToSelected" parameterType="kr.sh86.myApp.survey.domain.Mms">
	INSERT INTO XROSHOT.SDK_MMS_SEND(
		msg_id, 
		user_id, 
		schedule_type, 
		subject, 
		now_date, 
		send_date, 
		callback, 
		dest_count, 
		dest_info, 
		mms_msg)
	VALUES(
		XROSHOT.SDK_MMS_SEQ.NEXTVAL,
		'mystat03',
		#{scheduleType},
		#{subject},
		TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
		TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
		#{callback},
		#{destCount},
		#{destInfo},
		#{mmsMsg})
</insert>

<!--총카운트 -->
<select id="selectUserCount" resultType="int">
	SELECT COUNT(*)
	FROM GLOCAL.USERS
</select>

<!-- 응답자 총 카운트 -->
<select id="selectResCount" resultType="int">
	SELECT COUNT(*)
	FROM GLOCAL.RESPONSE	
</select>

<!-- 모든답변응답자  -->
<select id="selectResAllCount" resultType="int">
	SELECT COUNT(*)
	FROM GLOCAL.USERS
	WHERE RES_COMPLETE = 31
</select>

<!-- 문자전송실패자 -->
<select id="selectMmsFailCount" parameterType="String" resultType="int">
	SELECT COUNT(*) 
	FROM glocal.users 
	WHERE USER_NAME IN (SELECT dest_name 
						FROM xroshot.sdk_mms_report_detail 
						WHERE send_date like #{lastTime}||'%' 
						AND result != 2)
</select>

<!-- 미응답자 조회 -->
<select id="selectNoResList" resultType="kr.sh86.myApp.survey.domain.Users">
	SELECT *
	FROM GLOCAL.USERS
	WHERE USER_NO NOT IN (SELECT USER_NO
						  FROM GLOCAL.RESPONSE)
</select>

<!--문자전송 실패자 조회 -->
<select id="selectMmsFailList" parameterType="String" resultType="kr.sh86.myApp.survey.domain.Users">
	SELECT * 
	FROM glocal.users 
	WHERE USER_NAME IN (SELECT dest_name 
						FROM xroshot.sdk_mms_report_detail 
						WHERE send_date like #{lastTime}||'%' 
						AND result != 2)
</select>

<!--문자발송 내역 인서트  -->
<insert id="insertMmsReport">
	INSERT INTO GLOCAL.MMSREPORT(NO, SENDDATE)
	VALUES(glocal_mms_seq.nextval, to_char(sysdate, 'yyyy-mm-dd hh:mm'))
	
</insert>

<!-- 발송내역 조회 -->
<select id="selectSendReport" resultType="String">
	SELECT SENDDATE
	FROM GLOCAL.MMSREPORT
	ORDER BY NO 
</select>

<!-- 마지막 문자발송시간 조회 -->
<select id="selectLastMmsTime" resultType="String">
	SELECT SENDDATE
	FROM GLOCAL.MMSREPORT
	ORDER BY NO DESC
</select>

<!-- 문자재발송자 조회 -->
<select id="selectReSendList" resultType="kr.sh86.myApp.survey.domain.Users">
	SELECT *
	FROM glocal.users 
	WHERE res_complete &lt; 31 
	OR res_complete IS NULL
</select>

<!-- 베스트폴 ARS 대상 중복제거 -->
<select id="selectBestpoll" resultType="kr.sh86.myApp.survey.domain.Ars">
	SELECT num, ars_num, name, tel
	FROM BESTPOLL_ARS.ARS_RESULT_KIS_BACK
	WHERE ARS_NUM = 197
</select>

<delete id="deleteBestpoll" parameterType="kr.sh86.myApp.survey.domain.Ars">
	DELETE
	FROM BESTPOLL_ARS.ARS_RESULT_KIS
	WHERE ARS_NUM = 198
	AND NAME = #{name}
	AND TEL = #{tel}
</delete>

<!-- ars 강제추출 -->
<select id="selectSample" resultType="kr.sh86.myApp.survey.domain.Sample">
	SELECT t_name, t_telno 
	FROM kis_stat.home_35
	WHERE t_sigungu='익산시' 
	AND t_is != 1
	AND t_dong IS NULL
</select>

<!--샘플링데이터 입력  -->
<insert id="insertSample" parameterType="kr.sh86.myApp.survey.domain.Sampling">
	INSERT INTO bestpoll_ars.ars_sampling_kis(
		num, 
		ars_num, 
		sido, 
		sigungu, 
		sample, 
		data_in_date)
	VALUES(
		bestpoll_ars.ars_sampling_kis_seq.nextval, 
		#{arsNum}, 
		#{sido}, 
		#{sigungu}, 
		#{sample}, 
		to_char(sysdate,'YYYY-MM-DD'))
</insert>

<insert id="insertArsResultTb" parameterType="kr.sh86.myApp.survey.domain.Sampling">
	INSERT INTO bestpoll_ars.ars_result_kis(
		num, 
		ars_num, 
		<if test="name != null and name != ''">name,</if>
		tel, 
		sido, 
		sigungu,
		dong, 
		data_in_date)
	VALUES(
		bestpoll_ars.ars_result_kis_seq.nextval, 
		#{arsNum}, 
		<if test="name != null and name != ''">#{name},</if>
		#{tel}, 
		#{sido}, 
		#{sigungu},
		#{dong}, 
		to_char(sysdate,'YYYY-MM-DD'))
</insert>

<!-- 임실샘플링 입력 -->
<insert id="insertSamplingImsil" parameterType="kr.sh86.myApp.survey.domain.Sampling">
	INSERT INTO BESTPOLL_ARS.ARS_SAMPLING_KIS(
		NUM, ARS_NUM, SIDO, SIGUNGU, 
		<if test="dong != null and dong !=''">dong,</if> 
		SAMPLE, DATA_IN_DATE)
	VALUES(
		BESTPOLL_ARS.ARS_SAMPLING_KIS_SEQ.NEXTVAL,
		#{arsNum},
		#{sido},
		#{sigungu},
		<if test="dong != null and dong !=''">#{dong},</if>
		#{sample},
		to_char(sysdate,'YYYY-MM-DD')
		)	
</insert>

<!-- 현재 통화가지 않은 가정집 전체 조회 -->
<select id="selectAllHome" parameterType="String" resultType="kr.sh86.myApp.survey.domain.Sample">
	SELECT t_telno, t_name, t_sido, t_sigungu, t_dong 
	FROM kis_stat.home_35 a
	WHERE t_sido='전북' 
	AND t_sigungu = '임실군' 
	AND t_dong = #{dong} 
	<!-- AND NOT EXISTS (select * 
					from bestpoll_ars.ars_result_kis b
					where ars_num &gt;= 197 
					and ars_num &lt;=204
					and a.t_telno = b.tel) -->
</select>

<!-- 성별확인 조회 -->
<select id="selectManCount" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT REPLIED_FILE, MSG_ID
	FROM XROSHOT.SDK_VMS_REPORT_DETAIL
	WHERE LENGTH(REPLIED_FILE) &gt;= 72
	AND SEND_DATE &gt;= '20180118120000'
</select>

<!-- 연령확인 조회 -->
<select id="selectAgeCount" parameterType="int" resultType="int">
	SELECT COUNT(*)
	FROM XROSHOT.SDK_VMS_REPORT_DETAIL
	WHERE LENGTH(REPLIED_FILE) &gt;= #{length}
	AND SEND_DATE &gt;= '20180118120000'
</select>

<!-- 연령별 응답확인을 위한 조회 -->
<select id="selectResForAgeCheck" resultType="String">
	SELECT REPLIED_FILE
	FROM XROSHOT.SDK_VMS_REPORT_DETAIL
	WHERE LENGTH(REPLIED_FILE) &gt;= 16
	AND SEND_DATE &gt;= '20180118120000'
</select>

<select id="selectResStat" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT 
		msg_id,
		replied_file,
		job_id,
		nvl(substr(replied_file, 10,1),'') as ans1, 
		nvl(substr(replied_file, 16,1),'') as ans2,
		nvl(substr(replied_file, 22,1),'') as ans3,
		nvl(substr(replied_file, 28,1),'') as ans4,
		nvl(substr(replied_file, 34,1),'') as ans5,
		nvl(substr(replied_file, 40,1),'') as ans6,
		nvl(substr(replied_file, 46,1),'') as ans7,
		nvl(substr(replied_file, 52,1),'') as ans8,
		nvl(substr(replied_file, 58,1),'') as ans9,
		nvl(substr(replied_file, 65,1),'') as ans10,
		nvl(substr(replied_file, 72,1),'') as ans11
	FROM XROSHOT.SDK_VMS_REPORT_DETAIL
	WHERE SEND_DATE &gt;= '20180118120000'
	AND LENGTH(replied_file) >= 72
</select>

<select id="selectResStat2" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT 
		msg_id,
		replied_file,
		job_id,
		phone_number,
		result, 
		tcs_result,
		send_date, 
		stime, 
		rtime, 
		duration,
		nvl(substr(replied_file, 10,1),'') as ans1, 
		nvl(substr(replied_file, 16,1),'') as ans2,
		nvl(substr(replied_file, 22,1),'') as ans3,
		nvl(substr(replied_file, 28,1),'') as ans4,
		nvl(substr(replied_file, 34,1),'') as ans5,
		nvl(substr(replied_file, 40,1),'') as ans6,
		nvl(substr(replied_file, 46,1),'') as ans7,
		nvl(substr(replied_file, 52,1),'') as ans8,
		nvl(substr(replied_file, 58,1),'') as ans9,
		nvl(substr(replied_file, 65,1),'') as ans10,
		nvl(substr(replied_file, 72,1),'') as ans11
	FROM XROSHOT.SDK_VMS_REPORT_DETAIL
	WHERE SEND_DATE &gt;= '20180118120000'
	<!-- AND LENGTH(replied_file) &gt;= 72 -->
</select>

<!-- 연락처세팅 -->
<select id="selectTels" resultType="String">
	SELECT TEL
	FROM GLOCAL.USERS2
</select>

<!-- 입력 -->
<insert id="insertArsResultTb2" parameterType="kr.sh86.myApp.survey.domain.Sampling">
	INSERT INTO bestpoll_ars.ars_result_kis(
		num, 
		<if test="arsNum != null and arsNum != ''">ars_num,</if> 
		tel, 
		sido, 
		sigungu,
		result,
		tcs_result,
		data_in_date)
	VALUES(
		bestpoll_ars.ars_result_kis_seq.nextval, 
		<if test="arsNum != null and arsNum != ''">#{arsNum},</if>  
		#{tel}, 
		#{sido}, 
		#{sigungu},
		0,
		-2,
		to_char(sysdate,'YYYY-MM-DD'))
</insert>

<!-- 입력 -->
<insert id="insertArsResultTb3" parameterType="kr.sh86.myApp.survey.domain.Sampling">
	INSERT INTO bestpoll_ars.ars_result_kis_${local}(
		num 
		<if test="arsNum != null and arsNum != ''">,ars_num</if> 
		,tel 
		,sido 
		,sigungu
		,result
		,tcs_result
		,data_in_date)
	VALUES(
		#{num}
		<if test="arsNum != null and arsNum != ''">,#{arsNum}</if>  
		,#{tel} 
		,#{sido} 
		,#{sigungu}
		,0
		,-2
		,to_char(sysdate,'YYYY-MM-DD'))
</insert>

<select id="selectResultTb" parameterType="int" resultType="kr.sh86.myApp.survey.domain.Result">
	SELECT num, tel 
	FROM bestpoll_ars.ars_result_kis 
	WHERE result!=2 
	and result!=6 
	and result!=41 
	and ars_num=#{arsNum}
</select>

<select id="selectXroshotResult" parameterType="kr.sh86.myApp.survey.domain.Result" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT DISTINCT b.result, b.tcs_result, b.replied_file, 
		nvl(substr(b.replied_file, 10,1),'')as ans1, 
		nvl(substr(b.replied_file, 16,1),'')as ans2,
		nvl(substr(b.replied_file, 22,1),'')as ans3,
		nvl(substr(b.replied_file, 28,1),'')as ans4,
		nvl(substr(b.replied_file, 34,1),'')as ans5,
		nvl(substr(b.replied_file, 40,1),'')as ans6,
		nvl(substr(b.replied_file, 46,1),'')as ans7,
		nvl(substr(b.replied_file, 52,1),'')as ans8,
		nvl(substr(b.replied_file, 58,1),'')as ans9,
		nvl(substr(b.replied_file, 65,1),'')as ans10,
		nvl(substr(b.replied_file, 72,1),'')as ans11
	FROM xroshot.sdk_vms_report_detail b, xroshot.sdk_vms_report c 
	WHERE c.msg_id = b.msg_id 
	and b.phone_number = #{tel} 
	and c.attach_file= #{attachFile}
	and b.send_date like to_char(sysdate,'rrrr')|| '%')
</select>

<update id="updateArsResult" parameterType="kr.sh86.myApp.survey.domain.Xroshot">
	UPDATE bestpoll_ars.ars_result_kis 
	SET result=#{result},
	tcs_result =#{tcsResult},
	replied_file = #{repliedFile}
	WHERE tel = #{phoneNumber}
</update>

<select id="selectAllResArs" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	select * 
	from XROSHOT.SDK_VMS_REPORT_DETAIL 
	where length(replied_file) >=72 
	and send_date >= '20180118120000'                                           <!-- 여긴가??????? -->
</select>

<select id="selectArsResultKis" parameterType="String" resultType="int">
	SELECT num
	FROM bestpoll_ars.ars_result_kis 
	WHERE tel = #{tel}
	AND ars_num = 206
</select>

<delete id="deleteRepeat" parameterType="int">
	DELETE
	FROM bestpoll_ars.ars_result_kis 
	WHERE num = #{num}
</delete>

<select id="selectCntTel" parameterType="String" resultType="int">
	SELECT count(*)
	FROM bestpoll_ars.ars_result_kis 
	WHERE tel = #{tel}
	AND ars_num = 206
</select>

<!-- 4번 안받은사람, 받았다가 바로 끈은사람 조회 -->
<select id="selectLast" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	select DISTINCT phone_number
	from xroshot.sdk_vms_report_detail 
	where result=4 and send_date &gt; '20180118120000'
	OR result =2 and send_date &gt; '20180118120000' and LENGTH(replied_file) &lt;= 10	
</select>

<!-- <select id="selectLast" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	select distinct phone_number 
	from XROSHOT.SDK_VMS_REPORT_DETAIL 
	where send_date &gt; '20180118120000'
	and result = 4	
</select> -->


<update id="updateLast" parameterType="int">
	UPDATE bestpoll_ars.ars_result_kis
	SET ars_num = 207
	WHERE num = #{num}
</update>

<insert id="insertResult" parameterType="kr.sh86.myApp.survey.domain.Xroshot">
	INSERT INTO ADMIN.ARSLOTATION(
		NUM 
		<if test="ans1 != null and ans1 != ''">,ANS1</if>
		<if test="ans2 != null and ans2 != ''">,ANS2</if>
		<if test="ans3 != null and ans3 != ''">,ANS3</if>
		<if test="ans4 != null and ans4 != ''">,ANS4</if>
		<if test="ans5 != null and ans5 != ''">,ANS5</if>
		<if test="ans6 != null and ans6 != ''">,ANS6</if>
		<if test="ans7 != null and ans7 != ''">,ANS7</if>
		<if test="ans8 != null and ans8 != ''">,ANS8</if>
		<if test="ans9 != null and ans9 != ''">,ANS9</if>
		<if test="ans10 != null and ans10 != ''">,ANS10</if>
		<if test="ans11 != null and ans11 != ''">,ANS11</if>
		<!-- <if test="jobId != null and jobId != ''">,JOB_ID</if> -->
		<if test="phoneNumber != null and phoneNumber != ''">,TEL</if>
		<if test="result != null and result != ''">,RESULT</if>
		<if test="tcsResult != null and tcsResult != ''">,TCS_RESULT</if>
		<if test="stime != null and stime != ''">,STIME</if>
		<if test="rtime != null and rtime != ''">,RTIME</if>
		<if test="repliedFile != null and repliedFile != ''">,REPLIED_FILE</if>
		<if test="duration != null and duration != ''">,DURATION</if>
		)
	VALUES(
		#{no}
		<if test="ans1 != null and ans1 != ''">,#{ans1}</if>
		<if test="ans2 != null and ans2 != ''">,#{ans2}</if>
		<if test="ans3 != null and ans3 != ''">,#{ans3}</if>
		<if test="ans4 != null and ans4 != ''">,#{ans4}</if>
		<if test="ans5 != null and ans5 != ''">, #{ans5}</if>
		<if test="ans6 != null and ans6 != ''">,#{ans6}</if>
		<if test="ans7 != null and ans7 != ''">,#{ans7}</if>
		<if test="ans8 != null and ans8 != ''">,#{ans8}</if>
		<if test="ans9 != null and ans9 != ''">,#{ans9}</if>
		<if test="ans10 != null and ans10 != ''">,#{ans10}</if>
		<if test="ans11 != null and ans11 != ''">,#{ans11}</if>
		<!-- <if test="jobId != null and jobId != ''">,#{jobId}</if> -->
		<if test="phoneNumber != null and phoneNumber != ''">,#{phoneNumber}</if>
		<if test="result != null and result != ''">,#{result}</if>
		<if test="tcsResult != null and tcsResult != ''">,#{tcsResult}</if>
		<if test="stime != null and stime != ''">,#{stime}</if>
		<if test="rtime != null and rtime != ''">,#{rtime}</if>
		<if test="repliedFile != null and repliedFile != ''">,#{repliedFile}</if>
		<if test="duration != null and duration != ''">,#{duration}</if>
		)
</insert>

<!-- 결번삭제 -->
<delete id="deleteOverlap">
	DELETE
	FROM KIS_STAT.HOME_35 a
	WHERE EXISTS (SELECT * 
				  FROM XROSHOT.SDK_VMS_REPORT_DETAIL b
				  WHERE a.t_telno = b.phone_number
				  AND result = 6
				  AND send_date > '20180118120000')
</delete>

<!--데이터 업로드 -->
<select id="selectDataUser" resultType="kr.sh86.myApp.survey.domain.User">
	SELECT 
		TEL, SIDO, SIGUNGU, DONG, NAME, HP
	FROM GLOCAL.USERS2
</select>

<!-- 홈디비에 데이터 추가 -->
<insert id="insertHome35" parameterType="kr.sh86.myApp.survey.domain.User">
	INSERT INTO KIS_STAT.HOME_35(
		t_is
		<if test="tel != null and tel != ''">,t_telno</if>
		,t_sido
		,t_sigungu
		<if test="dong != null and dong != ''">,t_dong</if>		
		<if test="sangse != null and sangse != ''">,t_addr</if>	
		<if test="name != null and name != ''">,t_name</if>
		<if test="hp != null and hp != ''">,t_hp</if>
		)
	VALUES(
		0
		<if test="tel != null and tel != ''">,#{tel}</if>
		,#{sido}
		,#{sigungu}
		<if test="dong != null and dong != ''">,#{dong}</if>		
		<if test="sangse != null and sangse != ''">,#{sangse}</if>	
		<if test="name != null and name != ''">,#{name}</if>
		<if test="hp != null and hp != ''">,#{hp}</if>
		)
</insert>

<!-- 중복 조회 -->
<select id="selectOverlap207" parameterType="String" resultType="int">
	SELECT COUNT(*)
	FROM BESTPOLL_ARS.ARS_RESULT_KIS
	WHERE TEL = #{tel}
	AND ARS_NUM = 207
</select>

<!-- 중복 조회 -->
<select id="selectOverlapHome35" parameterType="String" resultType="int">
	SELECT COUNT(*)
	FROM KIS_STAT.HOME_35
	WHERE T_TELNO = #{tel}
</select>

<!-- 전북대 동창회 데이터 조회 -->
<select id="selectJbuniv" parameterType="String" resultType="kr.sh86.myApp.survey.domain.User">
	SELECT
		NAME,
		HOME_PHONE as tel
	FROM JBUNIV.USERS a
	WHERE home_address like '%'||#{sigungu}||'%' 
	AND home_phone is not null 
	AND home_phone like '063-___-____'
</select>


<!-- 생진원- 응답업체 입력 -->
<insert id="insertBioUser" parameterType="kr.sh86.myApp.survey.domain.BioUser">
	<selectKey keyProperty="no" resultType="int" order="BEFORE">
		select biouser_seq.nextval FROM DUAL
	</selectKey>
	INSERT INTO GLOCAL.BIOUSER(
		NO, COM_NAME, COM_IMPORT17, COM_WORKERCNT, COM_ADDRESS
		<if test="comCeo != null and comCeo != ''">,COM_CEO</if>
		<if test="comProduct != null and comProduct != ''">,COM_PRODUCT</if>
		<if test="comTel != null and comTel != ''">,COM_TEL</if>
		<if test="comHomepage != null and comHomepage != ''">,COM_HOMEPAGE</if>
		<if test="comFax != null and comFax != ''">,COM_FAX</if>
		<if test="comEmail != null and comEmail != ''">,COM_EMAIL</if>
		)
	VALUES(
		#{no}, #{comName}, #{comImport17}, #{comWorkerCnt}, #{comAddress}
		<if test="comCeo != null and comCeo != ''">,#{comCeo}</if>
		<if test="comProduct != null and comProduct != ''">,#{comProduct}</if>
		<if test="comTel != null and comTel != ''">,#{comTel}</if>
		<if test="comHomepage != null and comHomepage != ''">,#{comHomepage}</if>
		<if test="comFax != null and comFax != ''">,#{comFax}</if>
		<if test="comEmail != null and comEmail != ''">,#{comEmail}</if>
		)
</insert>

<!-- 생진원 - 업체응답내용 입력  -->
<insert id="insertBioRes" parameterType="kr.sh86.myApp.survey.domain.BioResponse">
	<selectKey keyProperty="no" resultType="int" order="BEFORE">
		select biores_seq.nextval FROM DUAL
	</selectKey>
	INSERT INTO GLOCAL.BIORESPONSE(
		NO, Q1, Q1C, Q2, Q2C, Q3, Q3C, Q4, Q4C, USERNO
		<if test="q5 != null and q5 != ''">,Q5</if>
		<if test="q5c != null and q5c != ''">,Q5C</if>
		<if test="q1Fir != null and q1Fir != ''">,Q1FIR</if>
		<if test="q1Sec != null and q1Sec != ''">,Q1SEC</if>
		<if test="q1Thi != null and q1Thi != ''">,Q1THI</if>
		<if test="q2Fir != null and q2Fir != ''">,Q2FIR</if>
		<if test="q2Sec != null and q2Sec != ''">,Q2SEC</if>
		<if test="q2Thi != null and q2Thi != ''">,Q2THI</if>
		<if test="q2Etc != null and q2Etc != ''">,Q2ETC</if>
		<if test="q3Fir != null and q3Fir != ''">,Q3FIR</if>
		<if test="q3Sec != null and q3Sec != ''">,Q3SEC</if>
		<if test="q3Thi != null and q3Thi != ''">,Q3THI</if>
		<if test="q3Etc != null and q3Etc != ''">,Q3ETC</if>
		<if test="q4Fir != null and q4Fir != ''">,Q4FIR</if>
		<if test="q4Sec != null and q4Sec != ''">,Q4SEC</if>
		<if test="q4Thi != null and q4Thi != ''">,Q4THI</if>
		<if test="q4Etc != null and q4Etc != ''">,Q4ETC</if>
		<if test="q5Etc != null and q5Etc != ''">,Q5ETC</if>
		<if test="q6Etc != null and q6Etc != ''">,Q6ETC</if>
		)
	VALUES(
		#{no}, #{q1}, #{q1c}, #{q2}, #{q2c}, #{q3}, #{q3c}, #{q4}, #{q4c}, #{userNo}
		<if test="q5 != null and q5 != ''">,#{q5}</if>
		<if test="q5c != null and q5c != ''">,#{q5c}</if>
		<if test="q1Fir != null and q1Fir != ''">,#{q1Fir}</if>
		<if test="q1Sec != null and q1Sec != ''">,#{q1Sec}</if>
		<if test="q1Thi != null and q1Thi != ''">,#{q1Thi}</if>
		<if test="q2Fir != null and q2Fir != ''">,#{q2Fir}</if>
		<if test="q2Sec != null and q2Sec != ''">,#{q2Sec}</if>
		<if test="q2Thi != null and q2Thi != ''">,#{q2Thi}</if>
		<if test="q2Etc != null and q2Etc != ''">,#{q2Etc}</if>
		<if test="q3Fir != null and q3Fir != ''">,#{q3Fir}</if>
		<if test="q3Sec != null and q3Sec != ''">,#{q3Sec}</if>
		<if test="q3Thi != null and q3Thi != ''">,#{q3Thi}</if>
		<if test="q3Etc != null and q3Etc != ''">,#{q3Etc}</if>
		<if test="q4Fir != null and q4Fir != ''">,#{q4Fir}</if>
		<if test="q4Sec != null and q4Sec != ''">,#{q4Sec}</if>
		<if test="q4Thi != null and q4Thi != ''">,#{q4Thi}</if>
		<if test="q4Etc != null and q4Etc != ''">,#{q4Etc}</if>
		<if test="q5Etc != null and q5Etc != ''">,#{q5Etc}</if>
		<if test="q6Etc != null and q6Etc != ''">,#{q6Etc}</if>
		)
</insert>

<!-- 생진청 응답수 -->
<select id="selectBioResCount" resultType="int">
	SELECT COUNT(*) 
	FROM GLOCAL.BIORESPONSE
</select>

<!-- 예외번호 조회 -->
<select id="selectExceptionNum" resultType="kr.sh86.myApp.survey.domain.ExceptionTel">
	SELECT *
	FROM BESTPOLL_ARS.ARS_EXCEPTION_TEL
</select>

<delete id="deleteExcTel" parameterType="String">
	DELETE
	FROM BESTPOLL_ARS.ARS_RESULT_KIS
	WHERE TEL = #{tel}
</delete>

<select id="selectResJj" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT result, tcs_result, send_date, stime, rtime, duration, phone_number, msg_id, 
				  nvl(substr(replied_file, 9,1),'') as ans1, 
				  nvl(substr(replied_file, 15,1),'') as ans2,
				  nvl(substr(replied_file, 21,1),'') as ans3,
				  nvl(substr(replied_file, 27,1),'') as ans4,
				  nvl(substr(replied_file, 33,1),'') as ans5
	FROM xroshot.sdk_vms_report_detail 
	WHERE send_date > '20180516090000' 
	AND length(replied_file) >= 33
	ORDER BY SEND_DATE DESC
</select>

<!-- <select id="selectResJj" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT result, tcs_result, send_date, stime, rtime, duration, phone_number, msg_id, 
				  nvl(substr(replied_file, 9,1),'') as ans1, 
				  nvl(substr(replied_file, 15,1),'') as ans2,
				  nvl(substr(replied_file, 21,1),'') as ans3,
				  nvl(substr(replied_file, 27,1),'') as ans4,
				  nvl(substr(replied_file, 33,1),'') as ans5
	FROM xroshot.sdk_vms_report_detail 
	WHERE send_date > '20180408155500' 
	AND length(replied_file) >= 33
	AND substr(replied_file, 21, 1) != 3
	ORDER BY SEND_DATE DESC
</select> -->
<select id="selectDateForCompare" parameterType="String" resultType="int">
	SELECT COUNT(*)
	FROM KIS_STAT.COM35
	WHERE TELL = #{phoneNumber}
	AND sigungu like '전주시%'
</select>

<insert id="insertResJj" parameterType="kr.sh86.myApp.survey.domain.Xroshot">
	INSERT INTO BESTPOLL_ARS.TB_RESULT(
		no, result, result2, senddate, stime, rtime, duration, a1, a2, a3, a4, a5)
	VALUES(
		#{no}, #{result}, #{tcsResult}, #{sendDate}, #{stime}, #{rtime}, #{duration}, #{ans1}, #{ans2}, #{ans3}, #{ans4}, #{ans5})
</insert>

<!-- 지역별 국번 조회 -->
<select id="selectDialing" parameterType="kr.sh86.myApp.survey.domain.Dialing" resultType="kr.sh86.myApp.survey.domain.Dialing">
	SELECT *
	FROM BESTPOLL_ARS.ARS_DIALING
	WHERE LOCAL LIKE '%'||#{local}||'%'
</select>

<!-- 제외번호 조회 -->
<select id="selectExcTel" parameterType="kr.sh86.myApp.survey.domain.ExceptionTel" resultType="kr.sh86.myApp.survey.domain.ExceptionTel">
	SELECT *
	FROM BESTPOLL_ARS.ARS_EXCEPTION_TEL
	WHERE LOCAL LIKE '%'||#{local}||'%'
</select>

<!-- 표본 테이블 삭제 -->
<delete id="deleteArsResult">
	DELETE 
	FROM BESTPOLL_ARS.ARS_RESULT_KIS
</delete>

<!-- **크로샷 응답현황 조회 -->

<!-- 총발송 -->
<select id="selectTotalSend" parameterType="Map" resultType="int">
	select count(*) 
	from XROSHOT.SDK_VMS_REPORT_DETAIL 
	where send_date > #{sendDate}
	<if test="endDate != none">AND send_date &lt; #{endDate}</if>		
</select>

<!-- 접촉/비접촉등 사례 -->
<select id="selectres2" parameterType="Map" resultType="int">
	select count(*) 
	from XROSHOT.SDK_VMS_REPORT_DETAIL 
	where send_date > #{sendDate}
	and result = #{result}
	<if test="endDate != none">AND send_date &lt; #{endDate}</if>
</select>

<!-- 타겟삭제 -->
<delete id="deleteResultKis" parameterType="Map">
	delete 
	from bestpoll_ars.ars_result_kis 
	where tel in (select phone_number 
				  from XROSHOT.SDK_VMS_REPORT_DETAIL 
				  where send_date > #{sendDate}
				  and result = #{result})
</delete>

<!-- 응답현황 -->
<select id="selectResList" parameterType="Map" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT rownum as no, send_date, duration, 
		nvl(substr(replied_file, 9,1),'') as ans1, 
		nvl(substr(replied_file, 15,1),'') as ans2,
		nvl(substr(replied_file, 21,1),'') as ans3,
		nvl(substr(replied_file, 27,1),'') as ans4,
		nvl(substr(replied_file, 33,1),'') as ans5
	FROM xroshot.sdk_vms_report_detail 
	WHERE send_date > #{sendDate}
	<if test="endDate != none">AND send_date &lt; #{endDate}</if>
	AND length(replied_file) >= 33
	ORDER BY SEND_DATE DESC
</select>

<!-- 지역선택된 데이터 조회 -->
<select id="selectLocalByRes" parameterType="Map" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT send_date, phone_number, 
		nvl(substr(replied_file, 9,1),'') as ans1, 
		nvl(substr(replied_file, 15,1),'') as ans2,
		nvl(substr(replied_file, 21,1),'') as ans3,
		nvl(substr(replied_file, 27,1),'') as ans4,
		nvl(substr(replied_file, 33,1),'') as ans5
	FROM xroshot.sdk_vms_report_detail 
	WHERE send_date > #{sendDate}
	AND length(replied_file) >= #{localLen}
	ORDER BY SEND_DATE DESC
</select>

<!-- 자사 가정집 DB수정 -->
<update id="updateHomeDbByRes" parameterType="kr.sh86.myApp.survey.domain.Home35">
	UPDATE KIS_STAT.HOME_35
	SET t_sigungu = #{tSiGunGu},
		t_is = #{tIs}
		<if test="tDong != null and tDong !=''">,t_dong = #{tDong}</if>
	WHERE t_telno = #{tTelno}
</update>

<!-- **신용보증재단 만족도조사  시작**********************************************************************************************-->

<!-- 1. 조사대상자수 -->
<select id="selSinboTotalCnt" parameterType="Map" resultType="int">
	SELECT COUNT(*) 
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE &gt;= #{startDate} 
	AND SB_TAKEDATE &lt;= #{endDate}
</select>

<!-- 2. 응답자수 -->
<select id="selSinboResCnt" parameterType="Map" resultType="int">
	SELECT COUNT(*) 
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE &gt;= #{startDate}  
	AND SB_TAKEDATE &lt;= #{endDate} 
	AND SB_RESCHECK = '응답'
</select>

<!-- 3. 부재 -->
<select id="selSinboBujeCnt" parameterType="Map" resultType="int">
	SELECT COUNT(*) 
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE &gt;= #{startDate} 
	AND SB_TAKEDATE &lt;= #{endDate} 
	AND SB_ARSRESULT LIKE '부재'||'%' 
	AND SB_REJECT = 0 
	AND SB_RESCHECK = '미응답'
</select>

<!-- 4. 추후응답 -->
<select id="selSinboAfterCnt" parameterType="Map" resultType="int">
	SELECT COUNT(*) 
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE &gt;= #{startDate} 
	AND SB_TAKEDATE &lt;= #{endDate} 
	AND SB_ARSRESULT = '추후응답'
	AND SB_RESCHECK = '미응답'
</select>

<!-- 5. 응답거부 -->
<select id="selSinboRejectCnt" parameterType="Map" resultType="int">
	SELECT COUNT(*) 
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE &gt;= #{startDate} 
	AND SB_TAKEDATE &lt;= #{endDate} 
	AND SB_REJECT = 1 
	AND SB_RESCHECK = '미응답' 
</select>

<!-- 6. 문자1,2차 -->
<select id="selSinboMmsCnt" parameterType="Map" resultType="int">
	SELECT COUNT(*) 
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE &gt;= #{startDate} 
	AND SB_TAKEDATE &lt;= #{endDate}
	AND SB_RESCHECK= '미응답' 
	AND SB_ORDERCOUNT &lt;= 3 
	AND SB_REJECT = 0 
	AND SB_ARSRESULT IS NULL
</select>

<!-- 7.응답현황 조회 -->
<select id="selSinboResList" parameterType="Map" resultType="kr.sh86.myApp.survey.domain.ResData">
	SELECT a.survey_no, a.q1, a.q2, a.q3, a.q4, a.q5, a.q6, a.mem_id,
		b.sb_num, b.sb_rrn, b.sb_add, b.sb_branch, b.sb_josaja, b.sb_hp, b.sb_dateofest, b.sb_rescheck, b.sb_takedate, b.sb_upstream
	FROM KIS_2017.jjac_survey004 a, ADMIN.SINBO b
	WHERE a.MEM_ID = b.SB_NUM
	AND b.SB_TAKEDATE &gt;= #{startDate}
	AND b.SB_TAKEDATE &lt;= #{endDate}
</select>

<!-- 문자1차발송자 조회 -->
<select id="selSinboFirTarget" resultType="kr.sh86.myApp.survey.domain.Sinbo">
	SELECT SB_NUM, SB_CEO, SB_HP
	FROM ADMIN.SINBO 
	WHERE SB_TAKEDATE = TO_CHAR(SYSDATE,'YYYY-MM-DD')
</select>

<!-- 문자발송자 정보 수정 -->
<update id="updateSinboState" parameterType="kr.sh86.myApp.survey.domain.Sinbo">
	UPDATE ADMIN.SINBO 
	SET SB_ORDERCOUNT = #{sbOrderCount}, 
		SB_RESCHECK= #{sbResCheck}
		<if test="sbFirDate != null and sbFirDate != ''">,SB_FIRDATE = TO_CHAR(SYSDATE,'YYYY-MM-DD')</if>
		<if test="sbSecDate != null and sbSecDate != ''">,SB_SECDATE = TO_CHAR(SYSDATE,'YYYY-MM-DD')</if>
		<if test="sbThiDate != null and sbThiDate != ''">,SB_THIDATE = TO_CHAR(SYSDATE,'YYYY-MM-DD')</if>
	WHERE SB_NUM = #{sbNum}
</update>

<!-- 문자2,3차발송자 조회 -->
<select id="selSinboSecTarget" resultType="kr.sh86.myApp.survey.domain.Sinbo">
	SELECT SB_NUM, SB_CEO, SB_HP, SB_ORDERCOUNT 
	FROM ADMIN.SINBO 
	WHERE SB_ORDERCOUNT &gt; 0
	AND SB_ORDERCOUNT &lt; 4 
	AND SB_RESCHECK = '미응답'
	AND SB_TAKEDATE &gt;= '2018-12-03'                                     <!-- 2018-09-03 -->
	AND SB_TAKEDATE &lt; TO_CHAR(SYSDATE,'YYYY-MM-DD') 
	AND SB_REJECT = 0
</select>

<!-- 문자 전화조사후 부재,추후응답 발송자 조회 -->
<select id="selSinboLastTarget" resultType="kr.sh86.myApp.survey.domain.Sinbo">
	SELECT SB_NUM, SB_CEO, SB_HP, SB_ORDERCOUNT 
	FROM ADMIN.SINBO 
	WHERE SB_ORDERCOUNT &gt; 0
	AND SB_RESCHECK = '미응답'
	AND SB_ARSRESULT LIKE '부재'||'%'
	AND SB_TAKEDATE &gt;= '2018-12-03'                                   <!-- 2018-09-03 -->
	AND SB_TAKEDATE &lt;= TO_CHAR(SYSDATE,'YYYY-MM-DD') 
	AND SB_REJECT = 0
</select>

<!-- 문자 전화조사후 부재,추후응답 발송자 조회 -->
<select id="selSinboLastTarget2" resultType="kr.sh86.myApp.survey.domain.Sinbo">
	SELECT SB_NUM, SB_CEO, SB_HP, SB_ORDERCOUNT 
	FROM ADMIN.SINBO 
	WHERE SB_ORDERCOUNT &gt; 0
	AND SB_RESCHECK = '미응답'
	AND SB_ARSRESULT LIKE '추후응답'||'%'
	AND SB_TAKEDATE &gt;= '2018-12-03'                                             <!-- 2018-09-03 -->
	AND SB_TAKEDATE &lt;= TO_CHAR(SYSDATE,'YYYY-MM-DD') 
	AND SB_REJECT = 0
</select>

<!-- 신보 - 마지막 시퀀스 조회 -->
<select id="selSinboLastSbNum" resultType="int">
	SELECT MAX(SB_NUM)
	FROM ADMIN.SINBO
</select>

<!-- 신보 - 엑셀 데이터 입력 -->
<insert id="insertSinboExcel" parameterType="kr.sh86.myApp.survey.domain.Sinbo">
	INSERT INTO ADMIN.SINBO(
		SB_NUM, SB_COMPANY, SB_DATEOFEST, SB_CEO
		<if test="sbRrn != null and sbRrn != ''">, SB_RRN</if>
		, SB_ADD, SB_BRANCH, SB_JOSAJA, SB_HP, SB_UPSTREAM, SB_TAKEDATE, SB_ORDERCOUNT, SB_REJECT
	)
	VALUES(
		#{sbNum},#{sbCompany},#{sbDateOfEst},#{sbCeo}
		<if test="sbRrn != null and sbRrn != ''">,#{sbRrn}</if>
		,#{sbAdd},#{sbBranch},#{sbJosaja},#{sbHp},#{sbUpStream},TO_CHAR(SYSDATE, 'YYYY-MM-DD'),#{sbOrderCount},#{sbReject}
	)
</insert>

<!-- 2019신규시책 ******************************************************************************************************************-->
<insert id="addSurUser" parameterType="kr.sh86.myApp.survey.domain.SicheckUser">
	<selectKey keyProperty="no" resultType="int" order="BEFORE">
		select SICHECK_SEQ.nextval FROM DUAL
	</selectKey>
	INSERT INTO SURVEY0725.SURVEY2019(
		no, gender, age, local, job, regdate, po_num)
	VALUES(
		#{no}, #{gender}, #{age}, #{local}, #{job}, to_char(sysdate, 'yy-mm-dd hh:mm'), #{poNum})
</insert>

<update id="updateAnsByOrder" parameterType="kr.sh86.myApp.survey.domain.SicheckUser">
	UPDATE SURVEY0725.SURVEY2019
	SET regdate = to_char(sysdate, 'yy-mm-dd hh:mm')
		<if test="q1 != null and q1 != ''">,q1 = #{q1}</if>
		<if test="q2 != null and q2 != ''">,q2 = #{q2}</if>
		<if test="q3 != null and q3 != ''">,q3 = #{q3}</if>
		<if test="q4 != null and q4 != ''">,q4 = #{q4}</if>
		<if test="q5 != null and q5 != ''">,q5 = #{q5}</if>
		<if test="q6 != null and q6 != ''">,q6 = #{q6}</if>
		<if test="q7 != null and q7 != ''">,q7 = #{q7}</if>
		<if test="q8 != null and q8 != ''">,q8 = #{q8}</if>
		<if test="q9 != null and q9 != ''">,q9 = #{q9}</if>
		<if test="q10 != null and q10 != ''">,q10 = #{q10}</if>
	WHERE no = #{no}
</update>

<!-- 현황조회:지역별 -->
<select id="selSicheck" parameterType="Map" resultType="int">
	SELECT COUNT(*)
	FROM SURVEY0725.SURVEY2019
	WHERE LOCAL = #{local}
	<if test="gender != null and gender != ''">AND GENDER = #{gender}</if>
</select>

<!-- 응답내용 조회 -->
<select id="selSicheckResList" resultType="kr.sh86.myApp.survey.domain.SicheckUser">
	SELECT *
	FROM SURVEY0725.SURVEY2019
</select>

<!-- 문자발송 대상자 조회 -->
<select id="selSicheckMmsTarget" resultType="kr.sh86.myApp.survey.domain.Pomg">
	SELECT PO_NUM, PO_TEL2
	FROM ADMIN.PERSONAL_OMG
	WHERE PO_TEL2 IS NOT NULL
	AND PO_NUM NOT IN(SELECT PO_NUM 
					  FROM SURVEY0725.SURVEY2019 
					  WHERE PO_NUM IS NOT NULL)
	AND PO_NUM NOT IN(SELECT PO_NUM 
					  FROM SURVEY0725.SICHECKREJ)
</select>

<!-- 2019신규시책 - 수신거부 추가 -->
<insert id="addSicheckRej" parameterType="kr.sh86.myApp.survey.domain.Pomg">
	INSERT INTO SURVEY0725.SICHECKREJ(PO_NUM)
	VALUES(#{poNum})
</insert>


<!--===========================================================================================================================  -->

<!-- 수협재발송자 조회 - 부재중, 통화중 -->
<select id="getReTagetSuhyup" resultType="kr.sh86.myApp.survey.domain.Xroshot">
	SELECT dest_name, phone_number
	FROM XROSHOT.SDK_VMS_REPORT_DETAIL
	WHERE send_date > '20190126150000' AND result = 4
    OR send_date > '20190126150000' AND result = 5
</select>

<insert id="goReTargetSuhyup" parameterType="String">
	INSERT INTO XROSHOT.SDK_VMS_SEND (
		MSG_ID, USER_ID, MSG_SUBTYPE, SCHEDULE_TYPE, MENT_TYPE
		, VOICE_TYPE, SUBJECT, NOW_DATE, SEND_DATE, CALLBACK
		, REPLY_TYPE
		, REPLY_COUNT
		, CDR_ID
		, ATTACH_FILE
		, DEST_INFO)
	VALUES (
		XROSHOT.SDK_VMS_SEQ.nextval, 'mystat04', 32, 0, 0
		, 0, '테스트11', to_char(sysdate,'yyyymmddhh24mmss'), to_char(sysdate,'yyyymmddhh24mmss'), '0637142174'
		, 0
		, 0
		, ''
		, '여론조사샘플.mstg'
		, #{target})

</insert>

<!-- =============================================================================================================================== -->
<insert id="addSuv2019" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	<selectKey resultType="int" keyProperty="no" order="BEFORE">
		SELECT copy_seq.NEXTVAL FROM DUAL
	</selectKey>
	INSERT INTO SURVEY0725.COPYRIGHT(
		no, dq1, dq2, dq3, dq4, dq4etc, dq5, dq6, dq7)
	VALUES(
		#{no}, #{dQ1}, #{dQ2}, #{dQ3}, #{dQ4}, #{dQ4Etc}, #{dQ5}, #{dQ6}, #{dQ7})
</insert>

<!-- 문항입력1 -->
<update id="updateSuv2019" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET rq1 = #{rQ1}, rq2 = #{rQ2}, rq3=#{rQ3}, rq3etc=#{rQ3Etc}, rq41 = #{rQ41}, rq42=#{rQ42}, rq5=#{rQ5}
		,kq11=#{kQ11},kq11etc=#{kQ11Etc},kq12=#{kQ12},kq12etc=#{kQ12Etc},kq21=#{kQ21},kq21etc=#{kQ21Etc},kq22=#{kQ22},kq22etc=#{kQ22Etc}
		,kq31=#{kQ31},kq31etc=#{kQ31Etc},kq32=#{kQ32},kq32etc=#{kQ32Etc},kq42=#{kQ42},kq42etc=#{kQ42Etc},kq51=#{kQ51},kq51etc=#{kQ51Etc}
		,kq52=#{kQ52},kq52etc=#{kQ52Etc},kq61=#{kQ61},kq61etc=#{kQ61Etc},kq62=#{kQ62},kq62etc=#{kQ62Etc}
	WHERE no = #{no}	
</update>

<!-- 문항입력2 -->
<update id="updateSuv20192" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET kq11=#{kQ11},kq11etc=#{kQ11Etc},kq12=#{kQ12},kq12etc=#{kQ12Etc},kq21=#{kQ21},kq21etc=#{kQ21Etc},kq22=#{kQ22},kq22etc=#{kQ22Etc}
		,kq31=#{kQ31},kq31etc=#{kQ31Etc},kq32=#{kQ32},kq32etc=#{kQ32Etc},kq42=#{kQ42},kq42etc=#{kQ42Etc},kq51=#{kQ51},kq51etc=#{kQ51Etc}
		,kq52=#{kQ52},kq52etc=#{kQ52Etc},kq61=#{kQ61},kq61etc=#{kQ61Etc},kq62=#{kQ62},kq62etc=#{kQ62Etc}
	WHERE no = #{no}	
</update>

<!-- 문항입력3 -->
<update id="updateSuv20193" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET cq11=#{cQ11}, cq12=#{cQ12}
		, cq13a11=#{cQ13A11}, cq13a12=#{cQ13A12}, cq13a13=#{cQ13A13}, cq13a14=#{cQ13A14}
		, cq13a21=#{cQ13A21}, cq13a22=#{cQ13A22}, cq13a23=#{cQ13A23}, cq13a24=#{cQ13A24}
		, cq13a31=#{cQ13A31}, cq13a32=#{cQ13A32}, cq13a33=#{cQ13A33}, cq13a34=#{cQ13A34}
		, cq13a41=#{cQ13A41}, cq13a42=#{cQ13A42}, cq13a43=#{cQ13A43}, cq13a44=#{cQ13A44}
		, cq13a51=#{cQ13A51}, cq13a52=#{cQ13A52}, cq13a53=#{cQ13A53}, cq13a54=#{cQ13A54}
		, cq13a61=#{cQ13A61}, cq13a62=#{cQ13A62}, cq13a63=#{cQ13A63}, cq13a64=#{cQ13A64}
		, cq13a71=#{cQ13A71}, cq13a72=#{cQ13A72}, cq13a73=#{cQ13A73}, cq13a74=#{cQ13A74}
		, cq13b13=#{cQ13B13}, cq13b23=#{cQ13B23}, cq13b33=#{cQ13B33}, cq13b43=#{cQ13B43}
		, cq13b51=#{cQ13B51}, cq13b53=#{cQ13B53}, cq13b63=#{cQ13B63}, cq13b73=#{cQ13B73}, cq13b81=#{cQ13B81}, cq13b83=#{cQ13B83}
		, cq13c12=#{cQ13C12}, cq13c14=#{cQ13C14}, cq13c22=#{cQ13C22}, cq13c24=#{cQ13C24}
		, cq13c32=#{cQ13C32}, cq13c34=#{cQ13C34}, cq13c44=#{cQ13C44}, cq13c52=#{cQ13C52}
		, cq13c54=#{cQ13C54}, cq14=#{cQ14}, cq15=#{cQ15}, cq15etc=#{cQ15Etc}, cq16=#{cQ16}, cq16etc=#{cQ16Etc}
		, cq17=#{cQ17}, cq17etc=#{cQ17Etc}, cq18=#{cQ18}, cq18etc=#{cQ18Etc}
		, cq19=#{cQ19}, cq191=#{cQ191}, cq110=#{cQ110}, cq110etc=#{cQ110Etc}, cq111=#{cQ111}
		, cq112=#{cQ112}, cq1121=#{cQ1121}, cq1121etc=#{cQ1121Etc}, cq1122=#{cQ1122}, cq1122etc=#{cQ1122Etc}
		, cq113=#{cQ113}, cq113etc=#{cQ113Etc}, cq114=#{cQ114}, cq1141=#{cQ1141}, cq1142=#{cQ1142}, cq115=#{cQ115}
		, cq115etc=#{cQ115Etc}, cq116=#{cQ116}, cq116etc=#{cQ116Etc}, cq117=#{cQ117}, cq117etc=#{cQ117Etc}, cq118=#{cQ118}, cq118etc=#{cQ118Etc}	
	WHERE no = #{no}	
</update>

<!-- 문항입력4 -->
<update id="updateSuv20194" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET 
		cq21=#{cQ21}, cq22=#{cQ22}, cq22etc=#{cQ22Etc}
		, cq23a11=#{cQ23A11}, cq23a12=#{cQ23A12}, cq23a13=#{cQ23A13}, cq23a14=#{cQ23A14}
		, cq23a21=#{cQ23A21}, cq23a22=#{cQ23A22}, cq23a23=#{cQ23A23}, cq23a24=#{cQ23A24}
		, cq23a31=#{cQ23A31}, cq23a32=#{cQ23A32}, cq23a33=#{cQ23A33}, cq23a34=#{cQ23A34}
		, cq23a41=#{cQ23A41}, cq23a42=#{cQ23A42}, cq23a43=#{cQ23A43}, cq23a44=#{cQ23A44}
		, cq23a51=#{cQ23A51}, cq23a52=#{cQ23A52}, cq23a53=#{cQ23A53}, cq23a54=#{cQ23A54}
		, cq23a61=#{cQ23A61}, cq23a62=#{cQ23A62}, cq23a63=#{cQ23A63}, cq23a64=#{cQ23A64}
		, cq23a71=#{cQ23A71}, cq23a72=#{cQ23A72}, cq23a73=#{cQ23A73}, cq23a74=#{cQ23A74}
		, cq23b13=#{cQ23B13}, cq23b23=#{cQ23B23}, cq23b33=#{cQ23B33}, cq23b43=#{cQ23B43}
		, cq23b51=#{cQ23B51}, cq23b53=#{cQ23B53}, cq23b63=#{cQ23B63}, cq23b73=#{cQ23B73}
		, cq23b81=#{cQ23B81}, cq23b83=#{cQ23B83}, cq23c12=#{cQ23C12}, cq23c14=#{cQ23C14}
		, cq23c22=#{cQ23C22}, cq23c24=#{cQ23C24}, cq23c32=#{cQ23C32}, cq23c34=#{cQ23C34}
		, cq23c44=#{cQ23C44}, cq23c52=#{cQ23C52}, cq23c54=#{cQ23C54}, cq24=#{cQ24}, cq25=#{cQ25}
		, cq25etc=#{cQ25Etc}, cq26=#{cQ26}, cq26etc=#{cQ26Etc}, cq27=#{cQ27}, cq27etc=#{cQ27Etc}
		, cq28=#{cQ28}, cq28etc=#{cQ28Etc}, cq29=#{cQ29}, cq291=#{cQ291}, cq210=#{cQ210}, cq210etc=#{cQ210Etc}
		, cq211=#{cQ211}, cq212=#{cQ212}, cq2121=#{cQ2121}, cq2121etc=#{cQ2121Etc}, cq2122=#{cQ2122}
		, cq2122etc=#{cQ2122Etc}, cq213=#{cQ213}, cq213etc=#{cQ213Etc}, cq214=#{cQ214}, cq215=#{cQ215}
		, cq215etc=#{cQ215Etc}, cq216=#{cQ216}, cq216etc=#{cQ216Etc}, cq217=#{cQ217}, cq217etc=#{cQ217Etc}
		, cq218=#{cQ218}, cq218etc=#{cQ218Etc}
	WHERE no = #{no}	
</update>

<!-- 문항입력5 -->
<update id="updateSuv20195" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET 
		cq31=#{cQ31}, cq32=#{cQ32}, cq32etc=#{cQ32Etc}
		, cq33a11=#{cQ33A11}, cq33a12=#{cQ33A12}, cq33a13=#{cQ33A13}, cq33a14=#{cQ33A14}
		, cq33a21=#{cQ33A21}, cq33a22=#{cQ33A22}, cq33a23=#{cQ33A23}, cq33a24=#{cQ33A24}
		, cq33a31=#{cQ33A31}, cq33a32=#{cQ33A32}, cq33a33=#{cQ33A33}, cq33a34=#{cQ33A34}
		, cq33a41=#{cQ33A41}, cq33a42=#{cQ33A42}, cq33a43=#{cQ33A43}, cq33a44=#{cQ33A44}
		, cq33a51=#{cQ33A51}, cq33a52=#{cQ33A52}, cq33a53=#{cQ33A53}, cq33a54=#{cQ33A54}
		, cq33a61=#{cQ33A61}, cq33a62=#{cQ33A62}, cq33a63=#{cQ33A63}, cq33a64=#{cQ33A64}
		, cq33a71=#{cQ33A71}, cq33a72=#{cQ33A72}, cq33a73=#{cQ33A73}, cq33a74=#{cQ33A74}
		, cq33b13=#{cQ33B13}, cq33b23=#{cQ33B23}, cq33b33=#{cQ33B33}, cq33b43=#{cQ33B43}
		, cq33b51=#{cQ33B51}, cq33b53=#{cQ33B53}, cq33b63=#{cQ33B63}, cq33b73=#{cQ33B73}
		, cq33b81=#{cQ33B81}, cq33b83=#{cQ33B83}, cq33c12=#{cQ33C12}, cq33c14=#{cQ33C14}
		, cq33c22=#{cQ33C22}, cq33c24=#{cQ33C24}, cq33c32=#{cQ33C32}, cq33c34=#{cQ33C34}
		, cq33c44=#{cQ33C44}, cq33c52=#{cQ33C52}, cq33c54=#{cQ33C54}, cq33c62=#{cQ33C62}
		, cq33c64=#{cQ33C64}, cq33c72=#{cQ33C72}, cq33c74=#{cQ33C74}
		, cq34=#{cQ34}, cq35=#{cQ35}, cq35etc=#{cQ35Etc}, cq36=#{cQ36}, cq36etc=#{cQ36Etc}, cq37=#{cQ37}, cq37etc=#{cQ37Etc}
		, cq38=#{cQ38}, cq38etc=#{cQ38Etc}, cq39=#{cQ39}, cq391=#{cQ391}, cq310=#{cQ310}, cq310etc=#{cQ310Etc}, cq311=#{cQ311}
		, cq3121=#{cQ3121}, cq3121etc=#{cQ3121Etc}, cq3122=#{cQ3122}, cq3122etc=#{cQ3122Etc}, cq313=#{cQ313}, cq313etc=#{cQ313Etc}
		, cq314=#{cQ314}, cq315=#{cQ315}, cq315etc=#{cQ315Etc}, cq316=#{cQ316}, cq316etc=#{cQ316Etc}, cq317=#{cQ317}, cq317etc=#{cQ317Etc}
		, cq318=#{cQ318}, cq318etc=#{cQ318Etc}
	WHERE no = #{no}	
</update>

<!-- 문항입력6 -->
<update id="updateSuv20196" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET 
		cq41=#{cQ41}, cq42=#{cQ42}, cq43=#{cQ43}, cq43etc=#{cQ43Etc}, cq44=#{cQ44}, cq451=#{cQ451}, cq452=#{cQ452}, cq452etc=#{cQ452Etc}
		, cq46=#{cQ46}, cq46etc=#{cQ46Etc}, cq47=#{cQ47}, cq471=#{cQ471}, cq48=#{cQ48}, cq48etc=#{cQ48Etc}, cq49=#{cQ49}
		, cq410a11=#{cQ410A11}, cq410a12=#{cQ410A12}, cq410a13=#{cQ410A13}, cq410a14=#{cQ410A14}
		, cq410a21=#{cQ410A21}, cq410a22=#{cQ410A22}, cq410a23=#{cQ410A23}, cq410a24=#{cQ410A24}
		, cq410a31=#{cQ410A31}, cq410a32=#{cQ410A32}, cq410a33=#{cQ410A33}, cq410a34=#{cQ410A34}
		, cq410a41=#{cQ410A41}, cq410a42=#{cQ410A42}, cq410a43=#{cQ410A43}, cq410a44=#{cQ410A44}
		, cq410a51=#{cQ410A51}, cq410a52=#{cQ410A52}, cq410a53=#{cQ410A53}, cq410a54=#{cQ410A54}
		, cq410a61=#{cQ410A61}, cq410a62=#{cQ410A62}, cq410a63=#{cQ410A63}, cq410a64=#{cQ410A64}
		, cq410a71=#{cQ410A71}, cq410a72=#{cQ410A72}, cq410a73=#{cQ410A73}, cq410a74=#{cQ410A74}
		, cq410b12=#{cQ410B12}, cq410b13=#{cQ410B13}, cq410b14=#{cQ410B14}, cq410b22=#{cQ410B22}
		, cq410b23=#{cQ410B23}, cq410b24=#{cQ410B24}, cq410b32=#{cQ410B32}, cq410b33=#{cQ410B33}
		, cq410b34=#{cQ410B34}, cq410b42=#{cQ410B42}, cq410b43=#{cQ410B43}, cq410b44=#{cQ410B44}
		, cq410b52=#{cQ410B52}, cq410b53=#{cQ410B53}, cq410b54=#{cQ410B54}, cq410b62=#{cQ410B62}
		, cq410b63=#{cQ410B63}, cq410b64=#{cQ410B64}, cq410b71=#{cQ410B71}, cq410b72=#{cQ410B72}
		, cq410b73=#{cQ410B73}, cq410b74=#{cQ410B74}, cq410b81=#{cQ410B81}, cq410b82=#{cQ410B82}
		, cq410b83=#{cQ410B83}, cq410b84=#{cQ410B84}, cq411=#{cQ411}, cq412=#{cQ412}
		, cq412etc=#{cQ412Etc}, cq413=#{cQ413}, cq4131=#{cQ4131}, cq414=#{cQ414}, cq414etc=#{cQ414Etc}
		, cq415=#{cQ415}, cq416=#{cQ416}, cq4161=#{cQ4161}, cq4161etc=#{cQ4161Etc}, cq4162=#{cQ4162}
		, cq4162etc=#{cQ4162Etc}, cq417=#{cQ417}, cq417etc=#{cQ417Etc}, cq418=#{cQ418}, cq419=#{cQ419}
		, cq419etc=#{cQ419Etc}, cq420=#{cQ420}, cq420etc=#{cQ420Etc}, cq421=#{cQ421}, cq421etc=#{cQ421Etc}
		, cq422=#{cQ422}, cq422etc=#{cQ422Etc}		
	WHERE no = #{no}	
</update>

<!-- 문항입력6 -->
<update id="updateSuv20197" parameterType="kr.sh86.myApp.survey.domain.CopyRight">
	UPDATE SURVEY0725.COPYRIGHT
	SET 
		cq51=#{cQ51}, cq52=#{cQ52}
		, cq53a11=#{cQ53A11}, cq53a12=#{cQ53A12}, cq53a13=#{cQ53A13}, cq53a14=#{cQ53A14}
		, cq53a21=#{cQ53A21}, cq53a22=#{cQ53A22}, cq53a23=#{cQ53A23}, cq53a24=#{cQ53A24}
		, cq53a31=#{cQ53A31}, cq53a32=#{cQ53A32}, cq53a33=#{cQ53A33}, cq53a34=#{cQ53A34}
		, cq53a41=#{cQ53A41}, cq53a42=#{cQ53A42}, cq53a43=#{cQ53A43}, cq53a44=#{cQ53A44}
		, cq53a51=#{cQ53A51}, cq53a52=#{cQ53A52}, cq53a53=#{cQ53A53}, cq53a54=#{cQ53A54}
		, cq53a61=#{cQ53A61}, cq53a62=#{cQ53A62}, cq53a63=#{cQ53A63}, cq53a64=#{cQ53A64}
		, cq53a71=#{cQ53A71}, cq53a72=#{cQ53A72}, cq53a73=#{cQ53A73}, cq53a74=#{cQ53A74}
		, cq53b13=#{cQ53B13}, cq53b23=#{cQ53B23}, cq53b33=#{cQ53B33}, cq53b43=#{cQ53B43}
		, cq53b63=#{cQ53B63}, cq53b73=#{cQ53B73}, cq53b81=#{cQ53B81}, cq53b83=#{cQ53B83}
		, cq54=#{cQ54}, cq55=#{cQ55}, cq55etc=#{cQ55Etc}, cq56=#{cQ56}, cq56etc=#{cQ56Etc}
		, cq57=#{cQ57}, cq57etc=#{cQ57Etc}, cq58=#{cQ58}, cq58etc=#{cQ58Etc}, cq59=#{cQ59}
		, cq591=#{cQ591}, cq510=#{cQ510}, cq510etc=#{cQ510Etc}, cq511=#{cQ511}, cq512=#{cQ512}
		, cq5121=#{cQ5121}, cq5121etc=#{cQ5121Etc}, cq5122=#{cQ5122}, cq5122etc=#{cQ5122Etc}
		, cq513=#{cQ513}, cq513etc=#{cQ513Etc}, cq514=#{cQ514}, cq515=#{cQ515}, cq515etc=#{cQ515Etc}
		, cq516=#{cQ516}, cq516etc=#{cQ516Etc}, cq517=#{cQ517}, cq517etc=#{cQ517Etc}, cq518=#{cQ518}, cq518etc=#{cQ518Etc}		
	WHERE no = #{no}	
</update>

</mapper>